# tinydiary

軽量で最低限の機能のみを実装したウェブ日記。

## 動作環境

* PHP 8.0以上
    - PDO(SQLite)
* SQlite

## インストール方法

1. index.php をウェブからアクセス可能なディレクトリに置きます。
2. config-original.php を config.php にリネームし、index.php と同じディレクトリに置きます。
3. config.php を自分の環境に合わせて編集します。
    - `db_path` はデータベースファイルのパスです。ウェブに公開されない場所にします。
    - `timezone` は日記のタイムゾーンです。未指定の場合、システムのタイムゾーンが使用されます。
    - `title` は日記のタイトルです。ヘッダ等に表示されます。
    - `description` は日記の説明です。ヘッダ等に表示されます。
    - `password` は編集モードのパスワードです。他人に知られないようにしましょう。
    - `css` はカスタム CSS ファイルのパスです。未指定の場合 `default.css` が適用されます。
    - `favicon` は favicon へのパスです。
4. index.php にウェブブラウザからアクセスします。初回アクセス時に DB ファイルが自動的に作成されます。

## 日記閲覧・更新方法

* タイトルは常にページ先頭に表示され、日記トップへのリンクになっています。これにより、いつでも日記トップに戻ることが出来ます。
* タイトルの次に検索フォームが表示され、日記本文をキーワードで検索することが出来ます。
  - スペースで区切ることで複数の単語を AND 検索することが出来ます。
  - 検索結果が20件を超えると、20件以降は省略されます。
* 日記トップでは今月の日記が月モードで表示されます。日記は新しい日付分が上に表示されます。
* 日記表示には計8種の表示モードがあります。表示モードの詳細は後述します。
* 検索フォームの次にナビゲーションが表示され、年モード時には前後の年へ、年月モード時には前後の月へと当年へ、年月日モードでは前後の日へと当月へのリンクが表示されます。
* 日記の日付は当日の日モードへのリンクになっています。
* 日付の次に日記本文が表示されます。月モード、年モードでは該当する日の日記が繰り返し表示されます。
* ページ最後部にパスワードフォームが表示され、config.php で設定したパスワードを入力することで編集モードに入ることが出来ます。
* 編集モードでは日付表示の下に編集リンクが表示されます。編集画面で日記本文を編集することが出来ます。
* 日記本文を空にすると、その日の日記は削除されます。
* 編集モード時、ページ最後部にログアウトリンクが表示されます。

### 表示モード

クエリパラメータで年月日のそれぞれを独立して指定できるため、以下の8種の表示モードがあります。

| 表示モード | 年指定 | 月指定 | 日指定 | 動作 | リンク |
|---|---|---|---|---|---|
| 年モード | あり | なし | なし | 指定された年の1年分の日記を昇順で表示 | あり |
| 年月モード | あり | あり | なし | 指定された年月の1月分の日記を昇順で表示 | あり |
| 年月日モード | あり | あり | あり | 指定された年月日の1日分の日記を昇順で表示 | あり |
| 年日モード | あり | なし | あり | 指定された年日の12日分の日記を昇順で表示 | なし |
| 月モード | なし | あり | なし | 指定された月の全期間の日記を昇順で表示 | なし |
| 月日モード | なし | あり | あり | 指定された月日の全期間の日記を昇順で表示。長年日記 | あり |
| 日モード | なし | なし | あり | 指定された日の全期間の日記を昇順で表示 | なし |
| デフォルト| なし | なし | なし | 今月の1月分の日記を降順で表示 | あり |

リンクありになっているものは、日記スクリプトがどこかで表示している者です。なしになっている場合、クエリパラメータを直接指定する必要があります。

## データ構造

SQLite に格納されるテーブルは以下の通りです。

### articles テーブル

| カラム | 型 | 内容 | 制約、その他 |
|---|---|---|---|
| id | INTEGER | プライマリキー | AUTOINCREMENT |
| year | INTEGER | 年 | NOT NULL, year/month/dayで複合unique index |
| month | INTEGER | 月 | NOT NULL |
| day | INTEGER | 日 | NOT NULL |
| message | TEXT | 日記本文 | |

## tinyシリーズの思い

tinyシリーズではプログラムは1ファイルという構成になっています。これに設定ファイルを加え、基本的に2ファイルをコピーするだけで動作します。

近年のウェブアプリでは高機能・高性能を実現するのと引き換えに、構築に複雑な手順が必要になってきています。それ自体を否定するものではありませんが、CGI 時代のようにレンタルサーバでファイルをアップロードするだけでお手軽に動作させるということが出来なくなってしまいました。

そんな時代でもお手軽な選択肢もあってもよいのではないかということで、tiny シリーズではあえて1ファイル構成のプログラムとしています。ソースファイルを適切に分割して見通しをよくするというプログラム開発の常識とはあえて違うアプローチを行っているのはそのためというわけです。
